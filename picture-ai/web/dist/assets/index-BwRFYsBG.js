import{r as h,a as L,T as A,R as j,b as k,c as D,L as U,d as $,B as w,e as B,S as C,U as N,f as M,I as G,s as x,g as W}from"./vendor-antd-ByiXFufx.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function p(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=p(t);fetch(t.href,n)}})();var _={exports:{}},g={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z=h,q=Symbol.for("react.element"),H=Symbol.for("react.fragment"),K=Object.prototype.hasOwnProperty,Y=z.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,J={key:!0,ref:!0,__self:!0,__source:!0};function I(i,o,p){var s,t={},n=null,l=null;p!==void 0&&(n=""+p),o.key!==void 0&&(n=""+o.key),o.ref!==void 0&&(l=o.ref);for(s in o)K.call(o,s)&&!J.hasOwnProperty(s)&&(t[s]=o[s]);if(i&&i.defaultProps)for(s in o=i.defaultProps,o)t[s]===void 0&&(t[s]=o[s]);return{$$typeof:q,type:i,key:n,ref:l,props:t,_owner:Y.current}}g.Fragment=H;g.jsx=I;g.jsxs=I;_.exports=g;var r=_.exports,v={},S=L;v.createRoot=S.createRoot,v.hydrateRoot=S.hydrateRoot;const O="http://127.0.0.1:8000",Q=async i=>{const o=await fetch(`${O}/api/search`,{method:"POST",body:i});if(!o.ok){const s=await o.json().catch(()=>({detail:`HTTP error! status: ${o.status}`}));throw new Error(s.detail||"An unknown error occurred")}return{data:await o.json()}},V=async i=>{const o=await fetch(`${O}/api/generate`,{method:"POST",body:i});if(!o.ok){const s=await o.json().catch(()=>({detail:`HTTP error! status: ${o.status}`}));throw new Error(s.detail||"Generation failed")}return{data:await o.json()}},X="http://127.0.0.1:8000",Z=()=>{const[i,o]=h.useState("search"),[p,s]=h.useState([]),[t,n]=h.useState(""),[l,y]=h.useState([]),[m,b]=h.useState(!1),T=async(e,c)=>{const a=await(await fetch(e)).blob();return new File([a],c,{type:a.type})},E=async e=>{try{x.loading({content:"Downloading image...",key:"download"});const c="reference_image.png",f=await T(e,c);y([{uid:"-1",name:c,status:"done",url:e,originFileObj:f}]),o("generate"),x.success({content:"Image set as reference! Now enter a prompt.",key:"download"})}catch(c){console.error("Failed to set reference image:",c),x.error({content:"Failed to use image.",key:"download"})}},R=async()=>{if(!t&&l.length===0){x.error("Please enter text or upload an image.");return}b(!0);const e=new FormData,c=l.length>0?l[0]:null,f=(c==null?void 0:c.originFileObj)||c;if(f&&l.length>0){e.append("file",f);const a=new FileReader;a.onload=()=>{s(t?d=>[...d,{type:"mixed",content:a.result,text:t,isUser:!0}]:d=>[...d,{type:"image",content:a.result,isUser:!0}])},a.readAsDataURL(f)}else t&&s(a=>[...a,{type:"text",content:t,isUser:!0}]);t&&(e.append("text",t),i==="generate"&&e.append("prompt",t));try{let a;if(i==="search"){let u="5";!f&&t&&(u="5"),e.append("top_k",u),a=await Q(e)}else!e.has("prompt")&&t&&e.append("prompt",t),f&&!t&&(x.warning("For Image-to-Image generation, a prompt description is recommended."),e.append("prompt","optimize this image")),a=await V(e);const d=a.data.results;d&&d.length>0?d.forEach(u=>{const P=i==="search"?`${X}${u.path}`:u;s(F=>[...F,{type:"image",content:P,isUser:!1}])}):s(u=>[...u,{type:"text",content:"No results found.",isUser:!1}])}catch(a){console.error("Operation failed:",a),x.error(`Failed: ${a instanceof Error?a.message:"Unknown error"}`),s(d=>[...d,{type:"text",content:"Sorry, an error occurred.",isUser:!1}])}finally{b(!1),n(""),y([])}};return r.jsxs("div",{style:{padding:"20px",maxWidth:"800px",margin:"0 auto"},children:[r.jsx(A.Title,{level:2,style:{textAlign:"center"},children:"Multimodal AI Agent"}),r.jsx("div",{style:{textAlign:"center",marginBottom:"20px"},children:r.jsxs(j.Group,{value:i,onChange:e=>o(e.target.value),buttonStyle:"solid",children:[r.jsxs(j.Button,{value:"search",children:[r.jsx(k,{})," Search (检索)"]}),r.jsxs(j.Button,{value:"generate",children:[r.jsx(D,{})," Generate (生成)"]})]})}),r.jsxs("div",{style:{height:"60vh",overflowY:"auto",border:"1px solid #ccc",padding:"10px",marginBottom:"10px",borderRadius:"8px"},children:[r.jsx(U,{dataSource:p,renderItem:e=>r.jsx(U.Item,{style:{justifyContent:e.isUser?"flex-end":"flex-start",border:"none"},children:r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:e.isUser?"flex-end":"flex-start",maxWidth:"70%"},children:[e.type==="text"&&r.jsx("div",{style:{background:e.isUser?"#1677ff":"#f0f0f0",color:e.isUser?"#fff":"#000",padding:"10px",borderRadius:"10px"},children:e.content}),(e.type==="image"||e.type==="mixed")&&r.jsxs("div",{style:{background:e.isUser?"#1677ff":"#f0f0f0",padding:"10px",borderRadius:"10px",display:"flex",flexDirection:"column",gap:"8px",position:"relative"},children:[r.jsxs("div",{style:{position:"relative"},children:[r.jsx("img",{src:e.content,alt:"content",style:{maxWidth:"100%",borderRadius:"8px",border:"1px solid #eee"}}),!e.isUser&&r.jsx($,{title:"Use this image as reference for next generation",children:r.jsx(w,{type:"primary",shape:"circle",icon:r.jsx(B,{}),size:"small",style:{position:"absolute",bottom:"8px",right:"8px",opacity:.8},onClick:()=>E(e.content)})})]}),e.type==="mixed"&&e.text&&r.jsx("div",{style:{color:e.isUser?"#fff":"#000",fontSize:"14px",wordBreak:"break-word",whiteSpace:"pre-wrap"},children:e.text})]})]})})}),m&&r.jsx("div",{style:{textAlign:"center",color:"#999"},children:"Processing..."})]}),r.jsxs(C.Compact,{style:{width:"100%"},children:[r.jsx(N,{fileList:l,beforeUpload:e=>(y([e]),!1),onRemove:()=>y([]),listType:"picture",maxCount:1,children:r.jsx(w,{icon:r.jsx(M,{})})}),r.jsx(G,{style:{width:"calc(100% - 100px)"},value:t,onChange:e=>n(e.target.value),placeholder:i==="search"?"输入文字搜图...":"输入描述生成图片...",onPressEnter:R,disabled:m}),r.jsx(w,{type:"primary",onClick:R,loading:m,children:i==="search"?"Search":"Generate"})]})]})};v.createRoot(document.getElementById("root")).render(r.jsx(W.StrictMode,{children:r.jsx(Z,{})}));
