# Picture-AI åœ°æ¯¯å›¾åƒç”Ÿæˆç³»ç»Ÿ â€” ç«å“åˆ†æä¸å·®å¼‚åŒ–å»ºè®®

## é¡¹ç›®æ¦‚è¿°

Picture-AI æ˜¯ä¸€ä¸ªä¸“æ³¨äº**åœ°æ¯¯å›¾åƒç”Ÿæˆ**çš„å‚ç›´é¢†åŸŸè§£å†³æ–¹æ¡ˆï¼Œä¸ºåœ°æ¯¯åˆ¶é€ /è®¾è®¡è¡Œä¸šæä¾›å®šåˆ¶åŒ–çš„ AI ç”Ÿå›¾èƒ½åŠ›ã€‚

---

## ä¸€ã€å½“å‰æ ¸å¿ƒåŠŸèƒ½åˆ†æï¼ˆæ’é™¤é€šç”¨åŠŸèƒ½åï¼‰

> ä»¥ä¸‹åŠŸèƒ½**ä¸è€ƒè™‘**æ–‡ç”Ÿå›¾ã€å›¾ç”Ÿå›¾ã€æœå›¾ç­‰é€šç”¨èƒ½åŠ›ï¼ˆå‡ ä¹æ‰€æœ‰ç”Ÿå›¾å·¥å…·éƒ½æœ‰ï¼‰ï¼Œä¸“æ³¨åˆ†æå·®å¼‚åŒ–ä»·å€¼ç‚¹ã€‚

### âœ… å·²å®ç°çš„å·®å¼‚åŒ–åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | è¯´æ˜ | æŠ€æœ¯å®ç° |
|---------|------|---------|
| **å‚ç›´é¢†åŸŸä¼˜åŒ–** | ä¸“ä¸ºåœ°æ¯¯åœºæ™¯å®šåˆ¶ï¼Œæ‰€æœ‰æç¤ºè¯ã€å‚æ•°å‡å›´ç»•åœ°æ¯¯è®¾è®¡ | `generate.py` ä¸­çš„ `_wrap_flat_design_production_prompt()` |
| **å¹³é¢è®¾è®¡ç¨¿è´¨æ£€ (QC)** | ä½¿ç”¨ VL å¤§æ¨¡å‹æ£€æµ‹ç”Ÿæˆç¨¿æ˜¯å¦æ»¡è¶³ç”Ÿäº§æ ‡å‡† | `vision_service.py` ä¸­çš„ `qc_flat_production_with_scores()` |
| **è‡ªç„¶è¯­è¨€ç¼–è¾‘æŒ‡ä»¤** | "æ”¹æˆè“è‰²"ã€"å˜äº®"ç­‰ä¸­æ–‡æŒ‡ä»¤è‡ªåŠ¨è§£æ | `prompt_translator.py` çš„è§„åˆ™å¼•æ“ |
| **Session åŒ–ç¼–è¾‘æµç¨‹** | ä¸Šä¼ â†’åˆ†å‰²â†’é€‰åŒºâ†’ç¼–è¾‘çš„å®Œæ•´äº¤äº’é“¾ | `interactive.py` çš„ upload/pick/edit API |
| **æ™ºèƒ½æç¤ºè¯æ‰©å†™** | å¯¹ç®€çŸ­è¾“å…¥è¿›è¡Œè¯­ä¹‰é€šé¡ºåŒ–ï¼Œä½†ä¸¥ç¦æ³¨å…¥æ–°å‚æ•° | `vision_service.py` çš„å—é™æ‰©å†™ç­–ç•¥ |

### âš ï¸ åˆ†å±‚ç¼–è¾‘ï¼ˆåˆæ­¥å®ç°ï¼‰

å½“å‰ `flat_segmenter.py` å®ç°äº†åŸºäº**è·ç¦»å˜æ¢ (Distance Transform)** çš„åœ°æ¯¯åˆ†å±‚ï¼š

- **rug_mask** â€” åœ°æ¯¯æ•´ä½“è½®å»“
- **border_mask** â€” è¾¹æ¡†åŒºåŸŸï¼ˆè·ç¦» â‰¤ Î± Ã— max_distï¼‰
- **field_mask** â€” å†…èŠ¯åŒºåŸŸï¼ˆè·ç¦» > Î± Ã— max_distï¼‰
- **background_mask** â€” èƒŒæ™¯

**å±€é™æ€§**ï¼š
1. åªæ”¯æŒå¹³é¢è®¾è®¡ç¨¿ï¼ˆç™½åº•/é€æ˜åº•ï¼‰ï¼Œä¸æ”¯æŒå®æ‹å›¾
2. åˆ†å±‚é¢—ç²’åº¦å›ºå®šï¼ˆborder/fieldï¼‰ï¼Œæ— æ³•å¤„ç†å¤šå±‚å›¾æ¡ˆ
3. æ²¡æœ‰è¯­ä¹‰åˆ†å‰²èƒ½åŠ›ï¼ˆæ— æ³•è¯†åˆ«"èŠ±æœµ"ã€"å‡ ä½•å›¾æ¡ˆ"ç­‰å…·è±¡å¯¹è±¡ï¼‰

---

## äºŒã€ä¸å¸‚é¢ç”Ÿå›¾å·¥å…·çš„å¯¹æ¯”

| èƒ½åŠ›ç»´åº¦ | å¸‚é¢é€šç”¨å·¥å…· (Midjourney/SD/DALL-E) | Picture-AI |
|---------|-----------------------------------|------------|
| **é¢†åŸŸä¸“æ³¨åº¦** | é€šç”¨ï¼Œéœ€ç”¨æˆ·è‡ªå†™ä¸“ä¸š prompt | âœ… åœ°æ¯¯ä¸“ç”¨ï¼Œå†…ç½®è¡Œä¸šæœ¯è¯­å’Œæ¨¡æ¿ |
| **ç”Ÿäº§ç¨¿åˆè§„æ€§** | æ— ï¼Œéœ€äººå·¥å®¡æ ¸ | âœ… è‡ªåŠ¨ QCï¼ˆæ»¡é“ºåº¦/é€è§†/é˜´å½±æ£€æµ‹ï¼‰ |
| **å‚æ•°åŒ–è°ƒè‰²** | éœ€é‡æ–°ç”Ÿæˆæˆ–æ‰‹åŠ¨ PS | âœ… ç‚¹å‡»é€‰åŒº + è‡ªç„¶è¯­è¨€æ¢è‰² |
| **æ‰¹é‡ä¸€è‡´æ€§** | ä¾èµ– seedï¼Œæ•ˆæœä¸ç¨³å®š | ğŸ”œ å¯æ‰©å±•ä¸ºè‰²å¡æ‰¹é‡æ¢è‰² |
| **è¡Œä¸š know-how** | æ—  | âœ… æç¤ºè¯å—é™æ‰©å†™ï¼Œé¿å…ç”Ÿæˆä¸ç¬¦åˆç”Ÿäº§çš„å›¾æ¡ˆ |

### æ ¸å¿ƒå·®å¼‚åŒ–ä¼˜åŠ¿

> [!IMPORTANT]
> **å‚ç›´åœºæ™¯ + ç”Ÿäº§å¯¼å‘ + é—­ç¯ç¼–è¾‘** æ˜¯ Picture-AI ä¸é€šç”¨ç”Ÿå›¾å·¥å…·çš„æ ¹æœ¬åŒºåˆ«ã€‚

1. **"è®¾è®¡åˆ°ç”Ÿäº§"ä¸€ç«™å¼** â€” ç”Ÿæˆåå¯ç›´æ¥å¯¼å‡ºç”Ÿäº§ç¨¿ï¼Œæ— éœ€äºŒæ¬¡åŠ å·¥
2. **è´¨æ£€è‡ªåŠ¨åŒ–** â€” å‡å°‘äººå·¥å®¡å›¾æˆæœ¬
3. **éç ´åæ€§å±€éƒ¨ç¼–è¾‘** â€” æ¢è‰²/è°ƒäº®åªå½±å“é€‰åŒºï¼Œä¿ç•™å…¶ä»–åŒºåŸŸ

---

## ä¸‰ã€ä¸‹ä¸€æ­¥åŠŸèƒ½å»ºè®® â€” è®©å®¢æˆ·è€³ç›®ä¸€æ–°

ä»¥ä¸‹æŒ‰**å†²å‡»åŠ› Ã— å¯è¡Œæ€§**æ’åºï¼Œæ¨èä¼˜å…ˆå®ç°å‰ 3 é¡¹ï¼š

### ğŸš€ Tier 1ï¼šé«˜å†²å‡»åŠ› + å¯å¿«é€Ÿäº¤ä»˜

| # | åŠŸèƒ½åç§° | æè¿° | ä¸ºä»€ä¹ˆè®©äººè€³ç›®ä¸€æ–° |
|---|---------|------|------------------|
| 1 | **AI é…è‰²åŠ©æ‰‹** | è¾“å…¥"ç§‹å†¬æ¬¾"æˆ–"åŒ—æ¬§é£"ï¼Œè‡ªåŠ¨æ¨è 3-5 å¥—é…è‰²æ–¹æ¡ˆå¹¶ä¸€é”®åº”ç”¨ | ç›´å‡»è®¾è®¡å¸ˆç—›ç‚¹ï¼Œçœå»æŒ‘è‰²æ—¶é—´ |
| 2 | **è‰²å¡æ‰¹é‡æ¢è‰²** | ä¸Šä¼ ä¸€å¼ è®¾è®¡ç¨¿ + ä¸€ç»„ Pantone/RAL è‰²å·ï¼Œè‡ªåŠ¨ç”Ÿæˆå…¨å¥—è‰²ç³»å˜ä½“ | ä¼ ç»Ÿ PS æ“ä½œéœ€æ•°å°æ—¶ï¼ŒAI ç§’å‡º |
| 3 | **ç”Ÿäº§ç¨¿è‡ªåŠ¨è£åˆ‡** | æ ¹æ®ç›®æ ‡å°ºå¯¸ï¼ˆå¦‚ 1.6m Ã— 2.3mï¼‰æ™ºèƒ½ç­‰æ¯”ç¼©æ”¾ + æ»¡é“ºè£åˆ‡ | ä¸€é”®é€‚é…ä¸åŒæ‰“æ ·è§„æ ¼ |

### ğŸŒŸ Tier 2ï¼šä¸­é«˜å†²å‡»åŠ› + éœ€ä¸€å®šç ”å‘

| # | åŠŸèƒ½åç§° | æè¿° | ä¸ºä»€ä¹ˆè®©äººè€³ç›®ä¸€æ–° |
|---|---------|------|------------------|
| 4 | **å›¾æ¡ˆå…ƒç´ åº“** | é¢„ç½®èŠ±çº¹/è¾¹æ¡†çŸ¢é‡å…ƒç´ ï¼Œç”¨æˆ·å¯æ‹–æ‹½ç»„åˆåå† AI è¡¥å…¨ | åŠè‡ªåŠ¨è®¾è®¡ï¼Œé™ä½åˆ›æ„é—¨æ§› |
| 5 | **å†å²ç‰ˆæœ¬å¯¹æ¯”** | å·¦å³åˆ†å±å±•ç¤ºç¼–è¾‘å‰åå·®å¼‚ï¼Œæ”¯æŒæ»‘åŠ¨æ¡åˆ‡æ¢ | å¢å¼ºå†³ç­–ä¿¡å¿ƒï¼Œå¸¸è§äºä¸“ä¸šè®¾è®¡è½¯ä»¶ |
| 6 | **3D æ•ˆæœé¢„è§ˆ** | å°†å¹³é¢ç¨¿è´´åˆ° 3D æˆ¿é—´åœºæ™¯ä¸­é¢„è§ˆå®é™…é“ºè®¾æ•ˆæœ | WOW çº§å±•ç¤ºï¼Œæå‡å®¢æˆ·ä¿¡ä»»æ„Ÿ |

### ğŸ”® Tier 3ï¼šé•¿æœŸåˆ›æ–°æ–¹å‘

| # | åŠŸèƒ½åç§° | æè¿° | ä¸ºä»€ä¹ˆè®©äººè€³ç›®ä¸€æ–° |
|---|---------|------|------------------|
| 7 | **è‰å›¾è½¬è®¾è®¡** | ç”¨æˆ·æ‰‹ç»˜è‰ç¨¿ï¼ˆiPad/çº¸è´¨æ‰«æï¼‰â†’ AI è‡ªåŠ¨ç”Ÿæˆå®Œæ•´åœ°æ¯¯è®¾è®¡ | æ‰“é€š"çµæ„Ÿâ†’æˆå“"å…¨æµç¨‹ |
| 8 | **é£æ ¼è¿ç§»** | ä¸Šä¼ ä¸€å¼ å–œæ¬¢çš„å®¶å±…å›¾ç‰‡ï¼Œæå–é£æ ¼åº”ç”¨åˆ°æ–°åœ°æ¯¯è®¾è®¡ | è®©éä¸“ä¸šå®¢æˆ·ä¹Ÿèƒ½ç²¾å‡†è¡¨è¾¾éœ€æ±‚ |
| 9 | **å¤šæ¨¡æ€å¯¹è¯** | "æŠŠä¸»èŠ±æ”¾å¤§ 20%"ã€"è¾¹æ¡†åŠ ç²—ä¸€ç‚¹" ç­‰è‡ªç„¶è¯­è¨€ç²¾ç»†æ§åˆ¶ | è¯­éŸ³/æ–‡å­—å³æŒ‡ä»¤ï¼Œæ‰€è§å³æ‰€å¾— |

---

## å››ã€å»ºè®®ä¼˜å…ˆçº§æ’åº

```mermaid
quadrantChart
    title åŠŸèƒ½ä¼˜å…ˆçº§çŸ©é˜µ
    x-axis å®ç°éš¾åº¦ --> é«˜
    y-axis å®¢æˆ·å†²å‡»åŠ› --> é«˜
    quadrant-1 ä¼˜å…ˆå®æ–½
    quadrant-2 è§„åˆ’ä¸­
    quadrant-3 ä½ä¼˜å…ˆ
    quadrant-4 å¿«é€Ÿäº¤ä»˜
    "AIé…è‰²åŠ©æ‰‹": [0.3, 0.85]
    "è‰²å¡æ‰¹é‡æ¢è‰²": [0.35, 0.9]
    "ç”Ÿäº§ç¨¿è‡ªåŠ¨è£åˆ‡": [0.25, 0.7]
    "å›¾æ¡ˆå…ƒç´ åº“": [0.55, 0.65]
    "å†å²ç‰ˆæœ¬å¯¹æ¯”": [0.4, 0.5]
    "3Dæ•ˆæœé¢„è§ˆ": [0.8, 0.75]
    "è‰å›¾è½¬è®¾è®¡": [0.85, 0.8]
    "é£æ ¼è¿ç§»": [0.7, 0.6]
    "å¤šæ¨¡æ€å¯¹è¯": [0.9, 0.7]
```

---

## äº”ã€æ€»ç»“

### å½“å‰ä¼˜åŠ¿
1. **å‚ç›´æ·±åº¦** â€” ä¸“ä¸ºåœ°æ¯¯è¡Œä¸šå®šåˆ¶ï¼Œè€Œéé€šç”¨å·¥å…·çš„"ä¸‡é‡‘æ²¹"
2. **ç”Ÿäº§é—­ç¯** â€” QC è´¨æ£€ + å¹³é¢ç¨¿æ ‡å‡† = è®¾è®¡å¯ç›´æ¥æŠ•äº§
3. **äº¤äº’åˆ›æ–°** â€” ç‚¹å‡»é€‰åŒº + è‡ªç„¶è¯­è¨€ç¼–è¾‘ï¼Œé—¨æ§›ä½äºä¼ ç»Ÿ PS

### çŸ­æœŸçªç ´
- **AI é…è‰²åŠ©æ‰‹** + **è‰²å¡æ‰¹é‡æ¢è‰²** å¯åœ¨ 1-2 å‘¨å†…äº¤ä»˜ï¼Œå½¢æˆæ˜æ˜¾å·®å¼‚åŒ–å–ç‚¹

### é•¿æœŸæŠ¤åŸæ²³
- æŒç»­ç§¯ç´¯åœ°æ¯¯è¡Œä¸š know-howï¼ˆèŠ±å‹ã€å·¥è‰ºã€è‰²å½©è¶‹åŠ¿ï¼‰
- æ„å»ºå›¾æ¡ˆå…ƒç´ åº“å’Œé£æ ¼æ¨¡æ¿ï¼Œå½¢æˆæ•°æ®èµ„äº§

---

> [!TIP]
> ä»¥ä¸‹ä¸º AI é…è‰²åŠ©æ‰‹çš„è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆã€‚

---

## å…­ã€AI é…è‰²åŠ©æ‰‹æŠ€æœ¯æ–¹æ¡ˆ

### 1. åŠŸèƒ½æ¦‚è¿°

ç”¨æˆ·è¾“å…¥é£æ ¼å…³é”®è¯ï¼ˆå¦‚"ç§‹å†¬æ¬¾"ã€"åŒ—æ¬§é£"ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨æ¨è 3-5 å¥—é…è‰²æ–¹æ¡ˆï¼Œç”¨æˆ·å¯ä¸€é”®åº”ç”¨åˆ°å½“å‰è®¾è®¡ã€‚

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant FE as å‰ç«¯
    participant BE as åç«¯
    participant LLM as DashScope

    U->>FE: ç‚¹å‡»"é…è‰²åŠ©æ‰‹"æŒ‰é’®
    FE->>FE: å¼¹å‡ºé£æ ¼é€‰æ‹©é¢æ¿
    U->>FE: é€‰æ‹©/è¾“å…¥é£æ ¼è¯ï¼ˆå¦‚"ç§‹å†¬æ¬¾"ï¼‰
    FE->>BE: POST /api/color-palette/recommend
    BE->>LLM: è°ƒç”¨ qwen-plus ç”Ÿæˆé…è‰²
    LLM-->>BE: è¿”å› JSON é…è‰²æ–¹æ¡ˆ
    BE-->>FE: è¿”å› 3-5 å¥—é…è‰²
    FE->>FE: æ¸²æŸ“é…è‰²å¡ç‰‡é¢„è§ˆ
    U->>FE: ç‚¹å‡»æŸå¥—é…è‰²"åº”ç”¨"
    FE->>FE: æ›´æ–° generateParams.color
```

### 2. åç«¯ API è®¾è®¡

#### æ–°å¢æ–‡ä»¶ï¼š`back/app/api/color_palette.py`

```python
from fastapi import APIRouter
from pydantic import BaseModel
from dashscope import Generation
from app.config.settings import settings

router = APIRouter()

class PaletteRequest(BaseModel):
    style_keyword: str  # å¦‚ "ç§‹å†¬æ¬¾"ã€"åŒ—æ¬§é£"
    count: int = 5      # è¿”å›é…è‰²æ–¹æ¡ˆæ•°é‡

class ColorScheme(BaseModel):
    name: str           # æ–¹æ¡ˆåç§°ï¼Œå¦‚ "æš–é˜³é©¼è‰²ç³»"
    primary: str        # ä¸»è‰² HEX
    secondary: str      # è¾…è‰² HEX
    accent: str         # ç‚¹ç¼€è‰² HEX
    description: str    # ä¸€å¥è¯è¯´æ˜

class PaletteResponse(BaseModel):
    schemes: list[ColorScheme]

@router.post("/color-palette/recommend", response_model=PaletteResponse)
async def recommend_palette(req: PaletteRequest) -> PaletteResponse:
    prompt = f"""ä½ æ˜¯åœ°æ¯¯é…è‰²ä¸“å®¶ã€‚è¯·ä¸º"{req.style_keyword}"é£æ ¼çš„åœ°æ¯¯æ¨è {req.count} å¥—é…è‰²æ–¹æ¡ˆã€‚

æ¯å¥—æ–¹æ¡ˆåŒ…å«ï¼š
- name: æ–¹æ¡ˆåç§°ï¼ˆ4-6å­—ï¼‰
- primary: ä¸»è‰² HEXï¼ˆå¦‚ #8B4513ï¼‰
- secondary: è¾…è‰² HEX
- accent: ç‚¹ç¼€è‰² HEX
- description: ä¸€å¥è¯è¯´æ˜é…è‰²æ€è·¯

ä»…è¾“å‡º JSON æ•°ç»„ï¼Œä¸è¦å…¶ä»–æ–‡å­—ï¼š
[{{"name":"...","primary":"#...","secondary":"#...","accent":"#...","description":"..."}}]"""

    response = Generation.call(
        api_key=settings.API_KEY,
        model="qwen-plus",
        messages=[{"role": "user", "content": prompt}],
        result_format="message",
    )

    # è§£æ JSONï¼ˆéœ€æ·»åŠ å®¹é”™ï¼‰
    import json
    raw = response.output.choices[0].message.content
    schemes = json.loads(raw)
    return PaletteResponse(schemes=[ColorScheme(**s) for s in schemes])
```

### 3. å‰ç«¯ç»„ä»¶è®¾è®¡

#### æ–°å¢æ–‡ä»¶ï¼š`web/src/components/shared/ColorPalettePanel.tsx`

```tsx
interface ColorScheme {
  name: string;
  primary: string;
  secondary: string;
  accent: string;
  description: string;
}

interface Props {
  onApply: (color: string) => void;
  onClose: () => void;
}

export const ColorPalettePanel: React.FC<Props> = ({ onApply, onClose }) => {
  const [keyword, setKeyword] = useState('');
  const [schemes, setSchemes] = useState<ColorScheme[]>([]);
  const [loading, setLoading] = useState(false);

  const handleRecommend = async () => {
    setLoading(true);
    const res = await fetch('/api/color-palette/recommend', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ style_keyword: keyword, count: 5 }),
    });
    const data = await res.json();
    setSchemes(data.schemes);
    setLoading(false);
  };

  return (
    <div className="palette-panel">
      <input value={keyword} onChange={(e) => setKeyword(e.target.value)} placeholder="è¾“å…¥é£æ ¼è¯ï¼Œå¦‚ ç§‹å†¬æ¬¾" />
      <button onClick={handleRecommend} disabled={loading}>
        {loading ? 'æ¨èä¸­...' : 'è·å–é…è‰²'}
      </button>
      <div className="scheme-grid">
        {schemes.map((s, i) => (
          <div key={i} className="scheme-card" onClick={() => onApply(s.primary)}>
            <div className="color-strip">
              <span style={{ background: s.primary }} />
              <span style={{ background: s.secondary }} />
              <span style={{ background: s.accent }} />
            </div>
            <div className="scheme-name">{s.name}</div>
            <div className="scheme-desc">{s.description}</div>
          </div>
        ))}
      </div>
    </div>
  );
};
```

### 4. é›†æˆåˆ°ä¸»é€»è¾‘

åœ¨ `InputArea.tsx` ä¸­æ·»åŠ é…è‰²åŠ©æ‰‹å…¥å£æŒ‰é’®ï¼Œç‚¹å‡»åå¼¹å‡º `ColorPalettePanel`ï¼Œç”¨æˆ·é€‰æ‹©é…è‰²åæ›´æ–° `generateParams.color`ã€‚

---

## ä¸ƒã€åç»­åŠŸèƒ½æ–¹æ¡ˆï¼ˆå¾…å±•å¼€ï¼‰

- **è‰²å¡æ‰¹é‡æ¢è‰²**ï¼šä¸Šä¼ è‰²å·åˆ—è¡¨ â†’ å¾ªç¯è°ƒç”¨åˆ†å±‚æ¢è‰² API â†’ æ‰“åŒ…ä¸‹è½½
- **ç”Ÿäº§ç¨¿è‡ªåŠ¨è£åˆ‡**ï¼šè¾“å…¥ç›®æ ‡å°ºå¯¸ â†’ è®¡ç®—ç¼©æ”¾æ¯”ä¾‹ â†’ æ™ºèƒ½æ»¡é“ºè£åˆ‡
